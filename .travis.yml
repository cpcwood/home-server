language: ruby
rvm: 2.7.2
env:
  global:
  - secure: haAd+u+eApObQEJwW5LP5I0hx8QihSdiRuyHBd5F/obQRA8WToSG0iWKw0dwjjHAmfOUe+9SA8ZMXf+WYsf7L1qcYQwMFDMttl6vZ8hVzOY0beww9MUZ0Y/siu1T99+fAst4kmHeQ1aTZHUJn0U7CLB0yBjGjdhVi34DuyM5zD9OTFb1aJ514ApXVWTkVinOEcnsE4S1Up3fuGtU0Az+HsVBeTztwbJy8IT1FFbJ+jtQUlf+J4YSdBlpP2P7BfxaAc7KpLttBlCHMo6OJv20uueAu877sJAWoW+zO9pbatl309JDULPmEln+bmVzeE7qQ9PUw9pfL5TKJvXuZlyF1rBN4I+/ph3vACAWgsf09Tvgfcz+sMNSP6AZAR++60DIsmeNxWY9oIZHIm/lhTjXbW1IZBSXw+/nbPR/8ZUhBp1jW2wkX6KqJqNfatfK/yE8f9E32/O63/GQrd9GHPb8LbDmGg5E7J4Uu2KH3smwlz38Ppcs3rymH1ZjPUTRCIaH36SP7O1hlQR5L5vT+pTvhJHIe4/Z5RbSzWNWwMtqxo7+huAvwKbPm6k77mMF+orPdBB3c5IT16AW3Rc0l1i0n+ti2JaoFFStuNCCBOUxT/ZsJAoFQARWRTgJsygIZohYCP7R10DVs1EXRHPDTZS60KT2Z0y6ziQvBLZEusRbB7g=
  jobs:
  - DB_USERNAME=cpcwood DB_PASSWORD=password
services:
- postgresql
cache:
  bundler: true
  yarn: true
  directories:
  - node_modules
before_install:
- psql -c "CREATE ROLE $DB_USERNAME SUPERUSER LOGIN CREATEDB UNENCRYPTED PASSWORD
  '$DB_PASSWORD';" -U postgres
- nvm install 14
- curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
- echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
- sudo apt-get update && sudo apt-get install yarn
- echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf && sudo sysctl
  -p
before_script:
- bundle install --without development
- yarn install
- bundle exec rails db:create db:migrate
- bundle exec rails webpacker:compile
script:
- bundle exec rspec
- bundle exec rubocop -a -c ./.rubocop.yml
- yarn test
- yarn lint
after_success:
- "./scripts/travis-ci-merge-script.sh"
